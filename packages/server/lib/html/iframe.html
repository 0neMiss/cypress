<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{{title}}</title>
  </head>
  <body>
    <script type="text/javascript">
      document.domain = '{{domain}}';
      
      (function(parent) {
        var Cypress = window.Cypress = parent.Cypress;
        if (!Cypress) {
          throw new Error("Tests cannot run without a reference to Cypress!");
        }

        /**
         * When we create a listener from the runner for the AUT, we need to ensure the function
         * is sourced from the AUT, otherwise the event will not be associated correctly.
         *
         * We do this by creating a function from the AUT window, keeping in state to ensure we
         * only have a single fn
         *
         * https://github.com/cypress-io/cypress/pull/15995
         * https://github.com/cypress-io/cypress/issues/19697
         */
        Cypress.bridgeContentWindowListener = function (fn) {
          return function () {
            // @ts-ignore
            fn.apply(this, arguments)
          }
        }

        return Cypress.onSpecWindow(window, {{scripts | safe}});
      })(window.opener || window.parent);
    </script>
  </body>
</html>
